Bootstrap: localimage
From: cuda_11.8.0-cudnn8-devel-ubuntu18.04.sif

%files
  src /app/src
  config /app/config
  pyproject.toml /app/pyproject.toml
  uv.lock /app/uv.lock

%post
  # setup container
  apt-get update
  apt-get install --no-install-recommends curl ca-certificates git ffmpeg make build-essential -y
  apt-get clean && rm -rf /var/lib/apt/lists/*

  # install UV
  curl -LsSf https://astral.sh/uv/0.7.8/install.sh -o /uv-installer.sh
  sh /uv-installer.sh && rm /uv-installer.sh
  export PATH="/root/.local/bin:$PATH"

  # install local dependencies
  . $HOME/.local/bin/env
  cd /app
  uv sync --locked

%runscript
  . $HOME/.local/bin/env
  cd /app
  uv run src/cli/train.py "$@"

%labels
  Author k.a.gibb@sussex.ac.uk
  Version v1.0.0
